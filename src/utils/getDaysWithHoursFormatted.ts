// URL to playground: www.typescriptlang.org/play?#code/PQKgUGDEAEDiBOB7ArgB2geVQUwHYEtcBzaACRXgGcIAxReaAQ2koBd7toAbRAY0fYNGqVF3z9W+RLgA0TaKwAW+eABMAtKkbxWAT2gBBAAoBJaAHd8XLtFRIAbvlWdEOAsWiKKlaIWgApAGUMADloADN6AFsBADoIAAMkgCtKaTAAbTBoaABvbJzoACJVRl0igC5iqOlS8pkCnKKvZCpK6CzCwvyurqLwpCj2ooAGAE4KgGYRoobewqL2YYAmEYqRmcbCgF8tgF0C7bm8rZKy4dZkbEo62dOWtqrO3p754oHEIarRiem7t+KS2+q3Wm3muy6BxyRwKryat2+5mwqlw11uxyaD0o7WeXThvX6g2G4ymMwxBKBxQAjBMNkUttD9odjvizuVvkpWjdzuTmt4cQyTgDCZ9ib8yYKmpSiiC6YKIYUodAYTlWQj3vAnDz7vynoL8X0Pl9iiS-uS+tLZWDegqckqVUKFuqipQBK10TquQL5gaFkaxaT-m9FogVms5eCmdCWadnZRkLgPX0sTj7WADkkEhAMLgWIJOM5WIwrLZGERrnIlC43IQSFiWIpGNZoAAjAv4SiiMrI3y5ohINCUeJgOgMbAAD0YUVE2DkzH7KBwqmg8GuyC4rGgvBQXGXPEQAGtuPgD5xsLEiMOAHzQACy0nUABUrlVTSN1FacmAbwB1ZGv8V1BpUEvxvR9FGQdRAgEADSQ-cMRggABhAwAFVHxMUIAEJDB8aQuH0bdcEobBeGQSR7ALMofG0ThVy4bB7EYXBN0iBgFzQWtK0UbBV18HwQgwaAQgAUREgARBREGgDj0HPS8IBve9cGAP9lxGAAOUF4JAgAKZS6iYRNoDU1FuX0WjoFwB8iJIsiKKo3RKAASlA6Bn04TTtKpLSNggIwGMYEjfGnBiojwTcq2gBJZKwPBa3ILkEgiBNeEkaQpM8ZjVAYhQeJkgdUFraBEHCLdpDs8j8Eo6A6h8ZBKGKqK7EQRxnGXIJQhKltklI1hhxAYAID0HAyG8ExcFQcjoAAXkdI0qjYTViAAbgKdhFtYZaiDW7Y1rAEbODi9wiEffBwomqbNzm146iqS7yPEso1pyLEqkSqgHtYDI9l2-bDrgQrkWOhKKFmx06qqQIvB0J7dB+l6IkGAB+TbtsR9hUbzdGwD24bdFG0cYlYVhkQQRdwdusp7smx7noKN6xq5L6EYKWSqlwZAojbeA-vx0avrh2aCgAH2gAByGpEzKcXRYly40RluXxaRFFFd0WWcjF8XOSoOpNegbWBi1DXlddS41CVrWJfjaWNf+gnOGh+hWCFubxeU8XDYljyve1tS-Z9iDA-FmhNRD6DWAjhNxf22zNxqXgDyeosqhB4gzou2nvr2cHnnxO6Jal-XyUZ3FuklJHPiqcW33F81Cg2iWrXr+VyT2Y4HQL6n5auczW66Mv9UrhaJbrhucib8WW4bh07U7mMukLlXkTMkutiHn0R8GGvx8rqfgI2AebXbhfYS2Zfdf70vvD1LeAVH2vxWP+Yp5ntv9jP1UL578XjfXwet8OjDwfjvMez8J5SRru-cEp9mTnyXr-c27oZY3y5HfF429q7gNJC-Xob8EJ4OjJ-eB39EG6BrrbABhQy4d3gb9CA8cZLYFYB9SgRMBCk2XHNXSpRU6YBrBnc62AWZ7GcmjWsP1Zo3leEwtixMuFwx8HNeRAglG8IEIwZy+0chMNksiJR4NZLqNUSTAx1FtEQByKuC2fYgaqCUXzMAcjohqLKCEKcnAeF1A8eFCRxBxHY2KjNGRBQbGtFzAkAAJLkHxnjYiUDELwbAukRhyCpM5WIvBGzwAMKwVJmT2CoRELxJCQUUnOW2DEuJ4UtgJKSSkqkchJjOTqewAAMogJE8AykkV0pUhITi9GFUMd46iBh4DwCqBwsxqhyZoB+oEpakjc4hMdEw1c8YNx5wYQUNi0BdJMM5tzXiJUyoZDSdAJp0BljNLkAAFjkAAVjkAANjEY6XRFVNx1XBnVCZ8BYjhCsKTeAukNG6FcmsuoF5CqzRmnNY5PNLFbHwGVCFQ4GLECUK5X0aKDl1ViFiogSh4VzQyZ83oTDDJzTqhc3ZAJ8UQtiFiZGRK8AksULiyu1i1wbliFNSgihdI8sKNE3Ipi4a+JSTCuolSqjVLKCy7w9KgWDG2OoRVuhlVclVewbYWYAQ5EsQCW0OxoDYC4MFX0XziKbgyMCqgrA5BcCCqwVZHQ6UjA7rVaisRVyUSoBU+lDK3ibPXP1QVwrRXisle4zxulHVsFiHKjVMS426GlbpV1ybU0Kptb0JN-UsSqqNKKtNuQc3FpVd62I+rDVvBNTaLYCpdhhJYRElcfLWBDO+REVxrtqLgwxWnQRp1hGiMCTMrh8zUBSLWa8Bim5ZLgxGDorttjfVOViDEVA4LC7p3HVnK6ch8Acy5si6RlKmVYXwK5cJ8Bcy5GgLEV9dQ5Arrxqi9FWEYWsvZdirllKcgrrmiugA1Fc9dXQH1PpfW+soH64V4y6G2roTLBR-prXsNVnxoBYQRVuygGR8DQHUFcnDJba1GkNiLTDSqqM4fYPhwjdLSPkapJR7DdbEBbG5fMUDBUKaQapIjRkWxYN5HgymxDQm0DKkRtsSxX7bKIAYkSxARBdLllYd4adyJdKJ2Tpo5yligA

/*

# Group Opening Hours

For a store locator application, a third-party API will provide opening hours in JSON format.

```json
[
  {
    "day": "monday",
    "hours": [
      {
        "from": "09:30",
        "to": "20:00"
      }
    ]
  },
  {
    "day": "tuesday",
    "hours": [
      {
        "from": "09:30",
        "to": "20:00"
      }
    ]
  },
  {
    "day": "wednesday",
    "hours": [
      {
        "from": "09:30",
        "to": "19:00"
      }
    ]
  },
  {
    "day": "thursday",
    "hours": [
      {
        "from": "09:30",
        "to": "20:00"
      }
    ]
  },
  {
    "day": "friday",
    "hours": [
      {
        "from": "09:30",
        "to": "20:00"
      }
    ]
  },
  {
    "day": "saturday",
    "hours": [
      {
        "from": "09:30",
        "to": "20:00"
      }
    ]
  },
  {
    "day": "sunday",
    "hours": []
  }
]
```

On store detail pages, the opening hours shall be displayed in groups.

For example, a grouped result could look like e.g.

> Mon-Tue: 09:30-20:00
> Wed: 09:30-19:00
> Thu-Sat: 09:30-20:00

CAUTION! As only consecutive days are relevant for grouping, there is NO NEED to group e.g.

> Mon/Wed 08:00-20:00 (Monday and Wednesday are non-consecutive days)
> Tue 08:00-18:00

Please implement the `groupOpeningHours` function to handle the grouping of consecutive days using the provided JSON object.

*/

export type InputDay =
  | 'monday'
  | 'tuesday'
  | 'wednesday'
  | 'thursday'
  | 'friday'
  | 'saturday'
  | 'sunday';

export type OpeningHours = {
  day: InputDay;
  hours: { from: string; to: string }[];
};

type HoursInput = {
  from: string;
  to: string;
};

// type GroupedOpeningHour = {
//   days: ShortDay[];
//   from?: string;
//   to?: string;
// };

type FormattedGroup = {
  day: InputDay;
  hours: HoursInput[];
  group: number;
};

// eslint-disable-next-line @typescript-eslint/naming-convention
const DAY_NAME_MAP = {
  monday: 'Mo',
  tuesday: 'Di',
  wednesday: 'Mi',
  thursday: 'Do',
  friday: 'Fr',
  saturday: 'Sa',
  sunday: 'So',
};

// type ShortDay = 'Mon' | 'Tue' | 'Wed' | 'Thu' | 'Fri' | 'Sat' | 'Sun';

const formatDayName = (dayName = 'monday'): string =>
  `${DAY_NAME_MAP[dayName] || ''}`;

export type FormattedResult = { left: string; right: string };

const groupDays = (daysArr: FormattedGroup[]): FormattedResult[] => {
  const result = [];

  for (let i = 0; i < 7; i + 1) {
    const days = daysArr.filter((day) => day.group === i);

    if (days.length) {
      if (days.length === 1) {
        const day = days[0];

        if (day.hours?.length) {
          result.push(
            {
              left: formatDayName(day.day),
              right: `${day.hours[0].from}-${day.hours[0].to} Uhr`,
            },
            // `${formatDayName(day.day)}: ${day.hours[0].from}-${day.hours[0].to}`
          );
        }
      } else {
        const reversedDays = days.reverse();

        const [first, last] = [days[0], reversedDays[0]];

        result.push({
          left: `${formatDayName(first.day)}-${formatDayName(last.day)}`,
          right: `${first.hours[0].from}-${last.hours[0].to} Uhr`,
        });
      }
    }
  }

  return result;
};

const formatDays = (days: OpeningHours[]): FormattedGroup[] => {
  let group = 0;

  return days.map((day: OpeningHours, i: number) => {
    if (!i) return { ...day, group };

    if (!day.hours?.length) {
      group += 1;

      return { ...day, group };
    }

    if (
      day.hours[0].from !== days[i - 1].hours[0].from ||
      day.hours[0].to !== days[i - 1].hours[0].to
    ) {
      group += 1;
    }

    return { ...day, group };
  });
};

export const getDaysWithHoursFormatted = (
  data: OpeningHours[],
): FormattedResult[] => groupDays(formatDays(data));

export default getDaysWithHoursFormatted;
